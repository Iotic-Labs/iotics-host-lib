# Copyright 2022 Iotic Labs Ltd.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://github.com/Iotic-Labs/iotics-host-lib/blob/master/LICENSE
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
; https://tox.readthedocs.io/en/latest/config.html
[tox]
envlist = flake8,pylint,py3
skipsdist = True


[testenv]
install_command = pip install -f ../deps {packages}


[testenv:flake8]
deps = -e .[lint]
commands = flake8 {{cookiecutter.module_name}}
           flake8 tests


[flake8]
exclude = venv env *.egg-info .git .tox


[testenv:pylint]
deps = -e .[lint,test]
commands = pylint --rcfile .pylint.rc {{cookiecutter.module_name}}
           pylint --rcfile .pylint.rc tests/unit/{{cookiecutter.module_name}} --disable=W0621,W0613,E1101,R0903,W0511


[testenv:py3]
deps = -e .[test]
setenv =
  PYTHONDONTWRITEBYTECODE = 1
commands = pytest -vv -o console_output_style=count --durations=10 \
           --cov --cov-report html --cov-report xml \
           --junitxml=test-{{cookiecutter.module_name}}-unit-results.xml --html=res/unit/index.html {posargs}


; https://docs.pytest.org/en/latest/reference.html#configuration-options
[pytest]
testpaths = tests/unit
python_files = tests.py test_*.py *_tests.py
junit_family = xunit2
log_cli = True
log_cli_level = Info


; https://coverage.readthedocs.io/en/latest/config.html
[coverage:run]
source = {{cookiecutter.module_name}}
branch = True


[report]
show_missing = True
